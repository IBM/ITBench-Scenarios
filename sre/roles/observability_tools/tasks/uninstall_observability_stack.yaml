---
- name: Create list of tools to uninstall
  ansible.builtin.set_fact:
    observability_releases:
      - name: "{{ ingress_installation_name }}"
        namespace: "{{ ingress_namespace_project_name }}"
      - name: "{{ prometheus_installation_name }}"
        namespace: "{{ prometheus_namespace_project_name }}"
      - name: "{{ grafana_installation_name }}"
        namespace: "{{ grafana_namespace_project_name }}"
      - name: "{{ jaeger_installation_name }}"
        namespace: "{{ jaeger_namespace_project_name }}"
      - name: "{{ es_installation_name }}"
        namespace: "{{ es_namespace_project_name }}"
      - name: "{{ opentelemetry_collector_installation_name }}"
        namespace: "{{ opentelemetry_collector_namespace_project_name }}"
      - name: "{{ loki_installation_name }}"
        namespace: "{{ loki_namespace_project_name }}"
      - name: "{{ opencost_installation_name }}"
        namespace: "{{ opencost_namespace_project_name }}"
      - name: "{{ opensearch_installation_name }}"
        namespace: "{{ opensearch_namespace_project_name }}"

- name: Uninstall observability tools
  kubernetes.core.helm:
    kubeconfig_path: "{{ kubeconfig }}"
    release_name: "{{ item.name }}"
    release_namespace: "{{ item.namespace }}"
    state: absent
    wait: true
  loop: "{{ observability_releases }}"

- name: Delete associated namespaces
  kubernetes.core.k8s:
    kubeconfig: "{{ kubeconfig }}"
    name: "{{ item.namespace }}"
    api_version: v1
    kind: Namespace
    state: absent
    wait: true
  loop: "{{ observability_releases }}"
