---
- name: Validate worker node configuration
  ansible.builtin.assert:
    that:
      - kops_cluster.nodes.worker.count > 0
      - kops_cluster.nodes.worker.count < 10
    fail_msg: Invalid number of worker nodes set. Must be between the range of 0 > x < 10.
    success_msg: Valid number of worker nodes configured.

- name: Validate if the bucket exists (when listing clusters)
  amazon.aws.s3_bucket_info:
    name: "{{ cluster.s3.bucket_name }}"
    region: "{{ cluster.aws.region }}"
  register: bucket_info

- name: Assert bucket exists
  ansible.builtin.assert:
    that:
      - cluster.s3.bucket_name in (bucket_info.buckets | map(attribute='name') | list)
    fail_msg: "S3 bucket '{{ cluster.s3.bucket_name }}' does not exist. Please check the value associated with cluster.s3.bucket_name at group_vars/development/kops_cluster.yaml."
    success_msg: "S3 bucket '{{ cluster.s3.bucket_name }}' exists."
