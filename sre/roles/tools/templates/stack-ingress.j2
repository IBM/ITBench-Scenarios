{% if tools_enabled.clickhouse %}
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: "{{ tools_helm_releases.clickhouse.name }}"
  namespace: "{{ tools_helm_releases.clickhouse.namespace }}"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:
          - pathType: ImplementationSpecific
            path: /clickhouse(/|$)(.*)
            backend:
              service:
                name: "{{ tools_helm_releases.clickhouse.name }}-clickhouse"
                port:
                  number: 8123
{% endif %}
{% if tools_enabled.jaeger %}
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: jaeger
  namespace: "{{ tools_helm_releases.opentelemetry_collectors.namespace }}"
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:
          - pathType: ImplementationSpecific
            path: /jaeger
            backend:
              service:
                name: jaeger-collector
                port:
                  number: 16686
{% endif %}
{% if tools_enabled.opencost %}
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: "{{ tools_helm_releases.opencost.name }}"
  namespace: "{{ tools_helm_releases.opencost.namespace }}"
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:
          - pathType: Prefix
            path: /
            backend:
              service:
                name: "{{ tools_helm_releases.opencost.name }}"
                port:
                  number: 9090
{% endif %}
{% if tools_enabled.prometheus or tools_enabled.opencost %}
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: "{{ tools_helm_releases.prometheus.name }}"
  namespace: "{{ tools_helm_releases.prometheus.namespace }}"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:
          - pathType: ImplementationSpecific
            path: /prometheus(/|$)(.*)
            backend:
              service:
                name: "{{ tools_helm_releases.prometheus.name }}-kube-prometheus-prometheus"
                port:
                  number: 9090
    - http:
        paths:
          - pathType: ImplementationSpecific
            path: /alertmanager(/|$)(.*)
            backend:
              service:
                name: "{{ tools_helm_releases.prometheus.name }}-kube-prometheus-alertmanager"
                port:
                  number: 9093
{% endif %}
